{% extends "base.html" %}

{% block content %}
<form action="/search" method="get" class="search-form" role="search">
  <input name="q" type="search" placeholder="Search your corpus..." value="{{ q }}" aria-label="Search query">
  <div class="filters">
    <label>
      Site filter:
      <input type="text" name="site" value="{{ site_filter }}" placeholder="example.com" aria-label="Restrict to domain">
    </label>
    <label style="display:flex; gap:0.4rem; align-items:center;">
      <input type="checkbox" name="in_title" {% if in_title %}checked{% endif %}>
      in:title
    </label>
    <button class="primary" type="submit">Search</button>
  </div>
  <input type="hidden" name="page" value="1">
</form>

{% if q %}
  <div class="meta" style="margin-top:1rem;">
    {% if total %}
      {{ total }} results in {{ "%.1f"|format(latency_ms) }} ms
    {% else %}
      No results in {{ "%.1f"|format(latency_ms) }} ms
    {% endif %}
  </div>
  <div class="results">
    {% for r in results %}
      <div class="result-item">
        <div><a href="{{ r.url }}" target="_blank" rel="noopener" style="font-size:1.1rem; font-weight:600;">{{ r.title }}</a></div>
        <div class="meta">{{ r.url }}</div>
        <p>{{ r.snippet | safe }}</p>
      </div>
    {% else %}
      <p>No matches yet. Try broadening your search.</p>
    {% endfor %}
  </div>
  <div class="pagination">
    {% if page > 1 %}
      <a href="/search?q={{ q }}&site={{ site_filter }}&in_title={% if in_title %}on{% endif %}&page={{ page - 1 }}">← Prev</a>
    {% endif %}
    {% if (page * per_page) < total %}
      <a href="/search?q={{ q }}&site={{ site_filter }}&in_title={% if in_title %}on{% endif %}&page={{ page + 1 }}">Next →</a>
    {% endif %}
  </div>
{% endif %}
{% endblock %}
